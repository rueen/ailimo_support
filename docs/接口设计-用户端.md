# 用户端接口设计

## 基础路径
```
/api/h5
```

## 1. 用户认证接口

### 1.1 发送验证码
**接口地址**: `POST /api/h5/auth/send-code`

**请求参数**:
```json
{
  "phone": "13800138000",  // 必填，手机号（11位）
  "type": 1                // 必填，类型：1-登录 2-注册
}
```

**响应数据**:
```json
{
  "code": 200,
  "message": "验证码已发送",
  "data": {
    "expireTime": "2026-01-07 16:05:00"  // 验证码过期时间（5分钟后）
  }
}
```

**业务逻辑**:
1. 验证手机号格式
2. 检查同一手机号1分钟内是否已发送过验证码（防止频繁发送）
3. 检查同一手机号当天发送次数是否超过10次
4. 生成6位随机数字验证码
5. **当前版本：直接返回验证码（模拟短信）**
6. 将验证码存入数据库，有效期5分钟
7. 未来版本：调用第三方短信服务发送验证码

**频率限制**: 同一手机号1分钟内只能发送1次，每天最多10次

**说明**: 开发阶段返回验证码方便测试
```json
{
  "code": 200,
  "message": "验证码已发送",
  "data": {
    "code": "123456",  // 开发阶段返回，生产环境删除此字段
    "expireTime": "2026-01-07 16:05:00"
  }
}
```

---

### 1.2 用户注册
**接口地址**: `POST /api/h5/auth/register`

**请求参数**:
```json
{
  "name": "张三",                    // 必填，姓名
  "phone": "13800138000",           // 必填，手机号（11位）
  "code": "123456",                 // 必填，验证码（6位）
  "organizationId": 1,              // 必填，组织机构ID
  "researchGroupId": 1,             // 必填，课题组ID
  "province": "浙江省",             // 必填，省份
  "city": "杭州市",                 // 必填，城市
  "district": "西湖区",             // 必填，区县
  "address": "文三路XXX号"          // 必填，详细地址
}
```

**响应数据**:
```json
{
  "code": 200,
  "message": "注册成功，请等待审核",
  "data": {
    "id": 10,
    "name": "张三",
    "phone": "13800138000",
    "auditStatus": 0,  // 0-待审核
    "createdAt": "2026-01-07 16:00:00"
  }
}
```

**业务逻辑**:
1. 验证手机号格式和唯一性
2. 验证验证码是否正确且未过期
3. 验证组织机构和课题组是否存在
4. 创建用户，审核状态设为"待审核"
5. 标记验证码为已使用
6. 用户需等待管理员审核通过后才能登录

**频率限制**: 同一IP每小时最多注册5次

---

### 1.3 用户登录
**接口地址**: `POST /api/h5/auth/login`

**请求参数**:
```json
{
  "phone": "13800138000",  // 必填，手机号
  "code": "123456"         // 必填，验证码
}
```

**响应数据**:
```json
{
  "code": 200,
  "message": "登录成功",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "user": {
      "id": 10,
      "name": "张三",
      "phone": "13800138000",
      "province": "浙江省",
      "city": "杭州市",
      "district": "西湖区",
      "address": "文三路XXX号",
      "organization": {
        "id": 1,
        "name": "浙江大学"
      },
      "researchGroup": {
        "id": 1,
        "name": "生物医学研究组"
      },
      "status": 1,
      "auditStatus": 1
    }
  }
}
```

**业务逻辑**:
1. 验证手机号和验证码
2. 检查用户是否存在
3. 检查用户状态是否启用
4. 检查审核状态是否通过
5. 生成JWT Token（有效期30天）
6. 标记验证码为已使用
7. 返回Token和用户信息

**错误情况**:
- 用户不存在：提示"该手机号未注册"
- 用户被禁用：提示"账号已被禁用，请联系管理员"
- 审核未通过：提示"账号审核中，请等待审核通过"或"账号审核未通过：{拒绝原因}"

**频率限制**: 同一IP每分钟最多尝试5次

---

### 1.4 获取个人信息
**接口地址**: `GET /api/h5/auth/profile`

**请求头**:
```
Authorization: Bearer <token>
```

**响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 10,
    "name": "张三",
    "phone": "13800138000",
    "province": "浙江省",
    "city": "杭州市",
    "district": "西湖区",
    "address": "文三路XXX号",
    "organization": {
      "id": 1,
      "name": "浙江大学"
    },
    "researchGroup": {
      "id": 1,
      "name": "生物医学研究组"
    },
    "status": 1,
    "auditStatus": 1,
    "createdAt": "2026-01-01 09:00:00"
  }
}
```

**权限要求**: 需要登录

---

### 1.5 退出登录
**接口地址**: `POST /api/h5/auth/logout`

**请求头**:
```
Authorization: Bearer <token>
```

**响应数据**:
```json
{
  "code": 200,
  "message": "退出成功",
  "data": null
}
```

**说明**: 前端删除Token即可

---

## 2. 设备租赁接口

### 2.1 设备列表
**接口地址**: `GET /api/h5/equipment`

**请求参数**:
```json
{
  "page": 1,          // 页码
  "pageSize": 10,     // 每页数量
  "name": "显微镜"    // 可选，设备名称模糊查询
}
```

**响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "list": [
      {
        "id": 1,
        "name": "高倍显微镜",
        "details": {
          "base_info": "德国进口高倍显微镜",
          "image": ["https://oss.example.com/img1.jpg"],
          "specs": "放大倍数1000倍"
        }
      }
    ],
    "total": 10,
    "page": 1,
    "pageSize": 10,
    "totalPages": 1
  }
}
```

**权限要求**: 需要登录

---

### 2.2 设备详情
**接口地址**: `GET /api/h5/equipment/:id`

**响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "name": "高倍显微镜",
    "details": {
      "base_info": "德国进口高倍显微镜",
      "image": ["https://oss.example.com/img1.jpg"],
      "specs": "放大倍数1000倍",
      "usage": "适用于细胞观察、组织切片等"
    }
  }
}
```

**权限要求**: 需要登录

---

### 2.3 查询设备可用时间段
**接口地址**: `GET /api/h5/equipment/:id/available-slots`

**请求参数**:
```json
{
  "date": "2026-01-10"  // 必填，查询日期
}
```

**响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "date": "2026-01-10",
    "availableSlots": [
      "11:00-12:00",
      "13:00-14:00",
      "14:00-15:00"
    ],
    "bookedSlots": [
      "09:00-10:00",
      "10:00-11:00"
    ]
  }
}
```

**权限要求**: 需要登录

---

### 2.4 获取设备租赁时间段列表
**接口地址**: `GET /api/h5/equipment-time-slots`

**响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 1,
      "startTime": "09:00:00",
      "endTime": "10:00:00",
      "displayTime": "9:00-10:00",
      "description": ""
    },
    {
      "id": 2,
      "startTime": "10:00:00",
      "endTime": "11:00:00",
      "displayTime": "10:00-11:00",
      "description": ""
    }
  ]
}
```

**说明**: 返回所有启用的时间段配置，按sortOrder排序

**权限要求**: 需要登录

---

### 2.5 获取提前预约天数配置（统一接口）
**接口地址**: `GET /api/h5/advance-days`

**响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "equipment_advance_days": 7,      // 设备租赁提前预约天数
    "cage_advance_days": 7,            // 笼位租赁提前预约天数
    "experiment_advance_days": 7       // 实验代操作提前预约天数
  }
}
```

**说明**: 统一返回所有模块的提前预约天数配置，避免多次请求

**权限要求**: 需要登录

---

### 2.6 提交设备租赁订单
**接口地址**: `POST /api/h5/equipment-orders`

**请求头**:
```
Authorization: Bearer <token>
```

**请求参数**:
```json
{
  "equipmentId": 1,                              // 必填，设备ID
  "reservationDate": "2026-01-10",               // 必填，预约日期
  "timeSlots": ["09:00-10:00", "10:00-11:00"],  // 必填，预约时间段数组
  "remark": "需要使用显微镜进行细胞观察"         // 可选，备注
}
```

**响应数据**:
```json
{
  "code": 200,
  "message": "提交成功，请等待审核",
  "data": {
    "id": 20,
    "equipmentId": 1,
    "reservationDate": "2026-01-10",
    "timeSlots": ["09:00-10:00", "10:00-11:00"],
    "status": 0,
    "createdAt": "2026-01-07 16:00:00"
  }
}
```

**业务逻辑**:
1. 验证设备是否存在且启用
2. 验证预约日期不能是过去的日期
3. 验证预约日期不能超过提前预约天数限制
4. 验证时间段格式和有效性
5. **检查设备在选定时间段是否可用**：
   - 查询该设备在该日期已审核通过（status=1）或已完成（status=3）的订单
   - 检查所选时间段是否与已有订单的时间段冲突
   - 如果冲突，返回错误提示"该时间段设备已被预约"
6. 创建订单，状态为"待审核"（注意：此时不占用设备，只有审核通过后才占用）
7. 自动关联当前登录用户

**权限要求**: 需要登录且审核通过

---

## 3. 笼位租赁接口

### 3.1 查询笼位可用数量
**接口地址**: `GET /api/h5/cages/available-quantity`

**请求参数**:
```json
{
  "animalTypeId": 1,       // 必填，动物类型ID
  "environmentId": 1,      // 必填，环境ID
  "date": "2026-01-10",    // 必填，查询日期
  "timeSlots": ["09:00-10:00", "10:00-11:00"]  // 必填，时间段数组
}
```

**响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "totalQuantity": 100,
    "availableQuantity": 70
  }
}
```

**权限要求**: 需要登录

---

### 3.2 获取笼位租赁时间段列表
**接口地址**: `GET /api/h5/cage-time-slots`

**响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 1,
      "startTime": "09:00:00",
      "endTime": "10:00:00",
      "displayTime": "9:00-10:00",
      "description": ""
    },
    {
      "id": 2,
      "startTime": "10:00:00",
      "endTime": "11:00:00",
      "displayTime": "10:00-11:00",
      "description": ""
    }
  ]
}
```

**说明**: 返回所有启用的时间段配置，按sortOrder排序

**权限要求**: 需要登录

---

### 3.3 提前预约天数配置

**说明**: 笼位租赁提前预约天数配置使用统一的 `GET /api/h5/advance-days` 接口获取（见2.5节），返回数据中包含 `cage_advance_days` 字段。

---

### 3.4 提交笼位租赁订单
**接口地址**: `POST /api/h5/cage-orders`

**请求头**:
```
Authorization: Bearer <token>
```

**请求参数**:
```json
{
  "animalTypeId": 1,                             // 必填，动物类型ID
  "environmentId": 1,                            // 必填，环境ID
  "quantity": 10,                                // 必填，数量
  "purposeId": 1,                                // 必填，用途ID
  "reservationDate": "2026-01-10",               // 必填，预约日期
  "timeSlots": ["09:00-10:00", "10:00-11:00"],  // 必填，预约时间段数组
  "remark": "需要繁殖用笼位"                     // 可选，备注
}
```

**响应数据**:
```json
{
  "code": 200,
  "message": "提交成功，请等待审核",
  "data": {
    "id": 20,
    "animalTypeId": 1,
    "environmentId": 1,
    "quantity": 10,
    "reservationDate": "2026-01-10",
    "status": 0,
    "createdAt": "2026-01-07 16:00:00"
  }
}
```

**业务逻辑**:
1. 验证动物类型、环境、用途是否存在
2. 验证预约日期和时间段
3. **检查笼位数量是否足够**：
   - 查询该动物类型+环境组合在该日期已审核通过（status=1）或已完成（status=3）的订单
   - 计算该日期各时间段已占用的笼位数量
   - 检查所选时间段是否有足够的可用笼位数量（总数量 - 已占用数量 >= 申请数量）
   - 如果数量不足，返回错误提示"该时间段可用笼位数量不足"
4. 创建订单，状态为"待审核"（注意：此时不占用笼位数量，只有审核通过后才占用）
5. 自动关联当前登录用户

**权限要求**: 需要登录且审核通过

---

## 4. 实验代操作接口

### 4.1 获取实验代操作时间段列表
**接口地址**: `GET /api/h5/experiment-time-slots`

**响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 1,
      "startTime": "09:00:00",
      "endTime": "12:00:00",
      "displayTime": "9:00-12:00",
      "description": "上午时段",
      "status": 1
    },
    {
      "id": 2,
      "startTime": "13:00:00",
      "endTime": "18:00:00",
      "displayTime": "13:00-18:00",
      "description": "下午时段",
      "status": 1
    },
    {
      "id": 3,
      "startTime": "18:00:00",
      "endTime": "24:00:00",
      "displayTime": "18:00-24:00",
      "description": "晚上时段（加班时间需额外付加班费）",
      "status": 1
    }
  ]
}
```

**说明**: 返回所有启用的时间段配置，用于前端多选，按sortOrder排序

**权限要求**: 需要登录

---

### 4.2 提前预约天数配置

**说明**: 实验代操作提前预约天数配置使用统一的 `GET /api/h5/advance-days` 接口获取（见2.5节），返回数据中包含 `experiment_advance_days` 字段。

---

### 4.3 提交实验代操作订单
**接口地址**: `POST /api/h5/experiment-orders`

**请求头**:
```
Authorization: Bearer <token>
```

**请求参数**:
```json
{
  "operationContentId": 1,                       // 必填，操作内容ID
  "animalTypeId": 1,                             // 必填，动物类型ID
  "quantity": 20,                                // 必填，动物数量
  "reservationDate": "2026-01-10",               // 必填，预约日期
  "timeSlots": ["09:00-12:00", "13:00-18:00"],  // 必填，预约时间段数组
  "remark": "需要进行灌胃操作"                   // 可选，备注
}
```

**响应数据**:
```json
{
  "code": 200,
  "message": "提交成功，请等待审核",
  "data": {
    "id": 20,
    "operationContentId": 1,
    "animalTypeId": 1,
    "quantity": 20,
    "reservationDate": "2026-01-10",
    "status": 0,
    "createdAt": "2026-01-07 16:00:00"
  }
}
```

**业务逻辑**:
1. 验证操作内容、动物类型是否存在
2. 验证预约日期
3. 验证时间段必须从预设的时间段列表中选择
4. 创建订单，状态为"待审核"
5. 自动关联当前登录用户

**权限要求**: 需要登录且审核通过

---

## 5. 动物订购接口

### 5.1 根据品牌获取种类/品系列表
**接口地址**: `GET /api/h5/animal-varieties`

**请求参数**:
```json
{
  "brandId": 1  // 必填，品牌ID
}
```

**响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 1,
      "name": "C57BL/6"
    },
    {
      "id": 2,
      "name": "BALB/c"
    }
  ]
}
```

**权限要求**: 需要登录

---

### 5.2 提交动物订购订单
**接口地址**: `POST /api/h5/animal-orders`

**请求头**:
```
Authorization: Bearer <token>
```

**请求参数**:
```json
{
  "brandId": 1,                      // 必填，品牌ID
  "varietyId": 1,                    // 必填，种类/品系ID
  "specificationId": 1,              // 必填，规格ID
  "gender": 0,                       // 必填，性别：0-雌性 1-雄性 2-不限
  "supervisorName": "李教授",        // 必填，导师姓名
  "ordererName": "张三",             // 必填，订购人姓名
  "contactPhone": "13800138000",     // 必填，联系电话
  "deliveryDate": "2026-01-15",      // 必填，到货日期
  "province": "浙江省",              // 必填，省份
  "city": "杭州市",                  // 必填，城市
  "district": "西湖区",              // 必填，区县
  "address": "文三路XXX号",          // 必填，详细地址
  "environmentId": 1,                // 必填，环境ID
  "requirementId": 1,                // 必填，要求ID
  "remark": "需要雌性小鼠"           // 可选，备注
}
```

**响应数据**:
```json
{
  "code": 200,
  "message": "提交成功，请等待处理",
  "data": {
    "id": 20,
    "brandId": 1,
    "varietyId": 1,
    "deliveryDate": "2026-01-15",
    "status": 0,
    "createdAt": "2026-01-07 16:00:00"
  }
}
```

**业务逻辑**:
1. 验证所有关联数据是否存在
2. 验证手机号格式
3. 验证到货日期不能是过去的日期
4. 创建订单，状态为"待处理"
5. 自动关联当前登录用户

**权限要求**: 需要登录且审核通过

---

## 6. 试剂耗材订购接口

### 6.1 提交试剂耗材订购订单
**接口地址**: `POST /api/h5/reagent-orders`

**请求头**:
```
Authorization: Bearer <token>
```

**请求参数**:
```json
{
  "name": "PCR试剂盒",               // 必填，试剂耗材名称
  "brandId": 1,                      // 必填，品牌ID
  "specificationId": 1,              // 必填，规格ID
  "quantity": 5,                     // 必填，数量
  "ordererName": "张三",             // 必填，订购人姓名
  "contactPhone": "13800138000",     // 必填，联系电话
  "deliveryDate": "2026-01-15",      // 必填，到货日期
  "province": "浙江省",              // 必填，省份
  "city": "杭州市",                  // 必填，城市
  "district": "西湖区",              // 必填，区县
  "address": "文三路XXX号",          // 必填，详细地址
  "remark": "急需试剂盒"             // 可选，备注
}
```

**响应数据**:
```json
{
  "code": 200,
  "message": "提交成功，请等待处理",
  "data": {
    "id": 20,
    "name": "PCR试剂盒",
    "brandId": 1,
    "deliveryDate": "2026-01-15",
    "status": 0,
    "createdAt": "2026-01-07 16:00:00"
  }
}
```

**业务逻辑**:
1. 验证品牌、规格是否存在
2. 验证手机号格式
3. 验证到货日期不能是过去的日期
4. 验证数量必须大于0
5. 创建订单，状态为"待处理"
6. 自动关联当前登录用户

**权限要求**: 需要登录且审核通过

---

## 7. 案例管理接口

### 7.1 案例列表
**接口地址**: `GET /api/h5/cases`

**请求参数**:
```json
{
  "page": 1,                  // 页码
  "pageSize": 10,             // 每页数量
  "projectName": "肿瘤",      // 可选，项目名称模糊查询
  "projectSummary": "研究"    // 可选，项目概述模糊查询
}
```

**响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "list": [
      {
        "id": 1,
        "projectName": "肿瘤免疫治疗研究",
        "projectSummary": "针对多种肿瘤的免疫治疗方法研究...",
        "images": [
          "https://oss.example.com/case1_1.jpg"
        ],
        "createdAt": "2026-01-01 00:00:00"
      }
    ],
    "total": 20,
    "page": 1,
    "pageSize": 10,
    "totalPages": 2
  }
}
```

**说明**: 只返回启用状态的案例

**权限要求**: 无需登录

---

### 7.2 案例详情
**接口地址**: `GET /api/h5/cases/:id`

**响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "projectName": "肿瘤免疫治疗研究",
    "projectSummary": "针对多种肿瘤的免疫治疗方法研究...",
    "projectResult": "成功开发出新型免疫治疗方案...",
    "images": [
      "https://oss.example.com/case1_1.jpg",
      "https://oss.example.com/case1_2.jpg"
    ],
    "createdAt": "2026-01-01 00:00:00"
  }
}
```

**权限要求**: 无需登录

---

## 8. 公司信息接口

### 8.1 获取公司信息
**接口地址**: `GET /api/h5/company-info`

**响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "companyName": "艾力默生物科技有限公司",
    "companyAddress": "浙江省杭州市西湖区文三路XXX号",
    "contactPhone": "0571-12345678",
    "email": "info@ailimo.com",
    "workTime": "周一至周五 9:00-18:00",
    "companyIntro": "艾力默生物科技是一家专注于实验动物服务的公司...",
    "serviceConcept": "专业、高效、贴心的一站式实验动物服务"
  }
}
```

**权限要求**: 无需登录

---

## 9. 通用接口

### 9.1 获取组织机构列表
**接口地址**: `GET /api/h5/organizations`

**响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 1,
      "name": "浙江大学"
    },
    {
      "id": 2,
      "name": "复旦大学"
    }
  ]
}
```

**权限要求**: 无需登录

---

### 9.2 根据组织机构获取课题组列表
**接口地址**: `GET /api/h5/research-groups`

**请求参数**:
```json
{
  "organizationId": 1  // 必填，组织机构ID
}
```

**响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 1,
      "name": "生物医学研究组"
    },
    {
      "id": 2,
      "name": "化学研究组"
    }
  ]
}
```

**权限要求**: 无需登录

---

### 9.3 获取环境类型列表
**接口地址**: `GET /api/h5/environment-types`

**响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 1,
      "name": "屏障环境"
    },
    {
      "id": 2,
      "name": "非屏障环境"
    }
  ]
}
```

**权限要求**: 需要登录

---

### 9.4 获取动物类型列表
**接口地址**: `GET /api/h5/animal-types`

**响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 1,
      "name": "小鼠"
    },
    {
      "id": 2,
      "name": "大鼠"
    }
  ]
}
```

**权限要求**: 需要登录

---

### 9.5 获取笼位用途列表
**接口地址**: `GET /api/h5/cage-purposes`

**响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 1,
      "name": "繁殖"
    },
    {
      "id": 2,
      "name": "实验"
    }
  ]
}
```

**权限要求**: 需要登录

---

### 9.6 获取操作内容列表
**接口地址**: `GET /api/h5/operation-contents`

**响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 1,
      "name": "灌胃"
    },
    {
      "id": 2,
      "name": "腹腔注射"
    }
  ]
}
```

**权限要求**: 需要登录

---

### 9.7 获取动物品牌列表
**接口地址**: `GET /api/h5/animal-brands`

**响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 1,
      "name": "上海南方模式生物"
    },
    {
      "id": 2,
      "name": "北京维通利华"
    }
  ]
}
```

**权限要求**: 需要登录

---

### 9.8 获取动物规格列表
**接口地址**: `GET /api/h5/animal-specifications`

**响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 1,
      "name": "6-8周龄"
    },
    {
      "id": 2,
      "name": "8-10周龄"
    }
  ]
}
```

**权限要求**: 需要登录

---

### 9.9 获取动物要求列表
**接口地址**: `GET /api/h5/animal-requirements`

**响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 1,
      "name": "SPF级"
    },
    {
      "id": 2,
      "name": "普通级"
    }
  ]
}
```

**权限要求**: 需要登录

---

### 9.10 获取试剂耗材品牌列表
**接口地址**: `GET /api/h5/reagent-brands`

**响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 1,
      "name": "Thermo Fisher"
    },
    {
      "id": 2,
      "name": "Sigma-Aldrich"
    }
  ]
}
```

**权限要求**: 需要登录

---

### 9.11 获取试剂耗材规格列表
**接口地址**: `GET /api/h5/reagent-specifications`

**响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 1,
      "name": "100次/盒"
    },
    {
      "id": 2,
      "name": "500ml/瓶"
    }
  ]
}
```

**权限要求**: 需要登录

---

## 10. 订单统一查询接口

### 10.1 我的所有订单
**接口地址**: `GET /api/h5/my-orders`

**请求头**:
```
Authorization: Bearer <token>
```

**请求参数**:
```json
{
  "page": 1,              // 页码
  "pageSize": 10,         // 每页数量
  "type": "equipment",    // 可选，订单类型：equipment-设备租赁 cage-笼位租赁 experiment-实验代操作 animal-动物订购 reagent-试剂耗材
  "status": 0,            // 可选，状态筛选：0-待审核/待处理 1-进行中 2-已拒绝 3-已完成 4-已取消
  "startDate": "2026-01-01",  // 可选，日期范围开始（预约日期或到货日期）
  "endDate": "2026-01-31"     // 可选，日期范围结束
}
```

**响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "list": [
      {
        "id": 1,
        "type": "equipment",
        "typeName": "设备租赁",
        "title": "高倍显微镜",
        "date": "2026-01-10",
        "status": 0,
        "statusText": "待审核",
        "createdAt": "2026-01-07 10:00:00"
      },
      {
        "id": 2,
        "type": "cage",
        "typeName": "笼位租赁",
        "title": "小鼠-屏障环境-10个",
        "date": "2026-01-10",
        "status": 1,
        "statusText": "进行中",
        "createdAt": "2026-01-06 15:00:00"
      },
      {
        "id": 3,
        "type": "experiment",
        "typeName": "实验代操作",
        "title": "灌胃-小鼠-20只",
        "date": "2026-01-10",
        "status": 0,
        "statusText": "待审核",
        "createdAt": "2026-01-05 09:00:00"
      },
      {
        "id": 4,
        "type": "animal",
        "typeName": "动物订购",
        "title": "C57BL/6 小鼠",
        "date": "2026-01-15",
        "status": 1,
        "statusText": "进行中",
        "createdAt": "2026-01-06 15:00:00"
      },
      {
        "id": 5,
        "type": "reagent",
        "typeName": "试剂耗材订购",
        "title": "PCR试剂盒",
        "date": "2026-01-15",
        "status": 0,
        "statusText": "待处理",
        "createdAt": "2026-01-07 11:00:00"
      }
    ],
    "total": 50,
    "page": 1,
    "pageSize": 10,
    "totalPages": 5
  }
}
```

**业务逻辑**:
1. 聚合查询所有类型的订单（设备租赁、笼位租赁、实验代操作、动物订购、试剂耗材订购）
2. 只返回当前登录用户的订单
3. 根据订单类型返回对应的标题和日期字段：
   - 设备租赁：title=设备名称，date=预约日期
   - 笼位租赁：title=动物类型-环境-数量，date=预约日期
   - 实验代操作：title=操作内容-动物类型-数量，date=预约日期
   - 动物订购：title=种类/品系名称，date=到货日期
   - 试剂耗材订购：title=试剂耗材名称，date=到货日期
4. 支持按订单类型、状态、日期范围筛选
5. 按创建时间倒序排列

**权限要求**: 需要登录

---

### 10.2 我的订单详情
**接口地址**: `GET /api/h5/my-orders/:type/:id`

**请求头**:
```
Authorization: Bearer <token>
```

**请求参数**:
- `type`: 订单类型（equipment/cage/experiment/animal/reagent）
- `id`: 订单ID

**响应数据**（根据订单类型返回不同的数据结构）:

**设备租赁订单详情**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "type": "equipment",
    "typeName": "设备租赁",
    "id": 1,
    "equipment": {
      "id": 1,
      "name": "高倍显微镜",
      "details": {
        "base_info": "德国进口高倍显微镜",
        "image": ["https://oss.example.com/img1.jpg"],
        "specs": "放大倍数1000倍"
      }
    },
    "reservationDate": "2026-01-10",
    "timeSlots": ["09:00-10:00", "10:00-11:00"],
    "status": 1,
    "statusText": "进行中",
    "remark": "需要使用显微镜进行细胞观察",
    "handler": {
      "id": 2,
      "name": "设备管理员"
    },
    "rejectReason": null,
    "auditTime": "2026-01-07 15:00:00",
    "completedTime": null,
    "createdAt": "2026-01-07 10:00:00"
  }
}
```

**笼位租赁订单详情**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "type": "cage",
    "typeName": "笼位租赁",
    "id": 1,
    "animalType": {
      "id": 1,
      "name": "小鼠"
    },
    "environment": {
      "id": 1,
      "name": "屏障环境"
    },
    "quantity": 10,
    "purpose": {
      "id": 1,
      "name": "繁殖"
    },
    "reservationDate": "2026-01-10",
    "timeSlots": ["09:00-10:00", "10:00-11:00"],
    "status": 1,
    "statusText": "进行中",
    "remark": "需要繁殖用笼位",
    "handler": {
      "id": 2,
      "name": "笼位管理员"
    },
    "rejectReason": null,
    "auditTime": "2026-01-07 15:00:00",
    "completedTime": null,
    "createdAt": "2026-01-07 10:00:00"
  }
}
```

**实验代操作订单详情**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "type": "experiment",
    "typeName": "实验代操作",
    "id": 1,
    "operationContent": {
      "id": 1,
      "name": "灌胃"
    },
    "animalType": {
      "id": 1,
      "name": "小鼠"
    },
    "quantity": 20,
    "reservationDate": "2026-01-10",
    "timeSlots": ["09:00-12:00", "13:00-18:00"],
    "status": 1,
    "statusText": "进行中",
    "remark": "需要进行灌胃操作",
    "handler": {
      "id": 2,
      "name": "实验操作员"
    },
    "rejectReason": null,
    "auditTime": "2026-01-07 15:00:00",
    "completedTime": null,
    "createdAt": "2026-01-07 10:00:00"
  }
}
```

**动物订购订单详情**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "type": "animal",
    "typeName": "动物订购",
    "id": 1,
    "brand": {
      "id": 1,
      "name": "上海南方模式生物"
    },
    "variety": {
      "id": 1,
      "name": "C57BL/6"
    },
    "specification": {
      "id": 1,
      "name": "6-8周龄"
    },
    "gender": 0,
    "genderText": "雌性",
    "supervisorName": "李教授",
    "ordererName": "张三",
    "contactPhone": "13800138000",
    "deliveryDate": "2026-01-15",
    "province": "浙江省",
    "city": "杭州市",
    "district": "西湖区",
    "address": "文三路XXX号",
    "environment": {
      "id": 1,
      "name": "屏障环境"
    },
    "requirement": {
      "id": 1,
      "name": "SPF级"
    },
    "status": 1,
    "statusText": "进行中",
    "remark": "需要雌性小鼠",
    "handler": {
      "id": 2,
      "name": "订购管理员"
    },
    "rejectReason": null,
    "auditTime": "2026-01-07 15:00:00",
    "completedTime": null,
    "createdAt": "2026-01-07 10:00:00"
  }
}
```

**试剂耗材订购订单详情**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "type": "reagent",
    "typeName": "试剂耗材订购",
    "id": 1,
    "name": "PCR试剂盒",
    "brand": {
      "id": 1,
      "name": "Thermo Fisher"
    },
    "specification": {
      "id": 1,
      "name": "100次/盒"
    },
    "quantity": 5,
    "ordererName": "张三",
    "contactPhone": "13800138000",
    "deliveryDate": "2026-01-15",
    "province": "浙江省",
    "city": "杭州市",
    "district": "西湖区",
    "address": "文三路XXX号",
    "status": 1,
    "statusText": "进行中",
    "remark": "急需试剂盒",
    "handler": {
      "id": 2,
      "name": "订购管理员"
    },
    "rejectReason": null,
    "auditTime": "2026-01-07 15:00:00",
    "completedTime": null,
    "createdAt": "2026-01-07 10:00:00"
  }
}
```

**业务逻辑**:
1. 根据订单类型（type）和订单ID（id）查询对应的订单详情
2. 只能查看自己的订单详情
3. 返回完整的订单信息，包括关联数据（设备、动物类型、操作内容等）

**权限要求**: 需要登录

