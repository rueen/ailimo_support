# 管理端接口 - 用户管理

## 基础路径
```
/api/support
```

## 1. 用户管理接口

### 1.1 用户列表
**接口地址**: `GET /api/support/users`

**请求参数**:
```json
{
  "page": 1,                // 页码
  "pageSize": 10,           // 每页数量
  "name": "张三",           // 可选，姓名模糊查询
  "phone": "138",           // 可选，手机号模糊查询
  "organizationId": 1,      // 可选，组织机构ID筛选
  "researchGroupId": 2,     // 可选，课题组ID筛选
  "status": 1,              // 可选，状态筛选：0-禁用 1-启用
  "auditStatus": 0          // 可选，审核状态：0-待审核 1-审核通过 2-审核拒绝
}
```

**响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "list": [
      {
        "id": 1,
        "name": "张三",
        "phone": "13800138000",
        "province": "浙江省",
        "city": "杭州市",
        "district": "西湖区",
        "address": "文三路XXX号",
        "organization": {
          "id": 1,
          "name": "浙江大学"
        },
        "researchGroup": {
          "id": 1,
          "name": "生物医学研究组"
        },
        "status": 1,
        "auditStatus": 1,
        "rejectReason": null,
        "auditTime": "2026-01-05 10:00:00",
        "auditBy": {
          "id": 1,
          "username": "admin"
        },
        "created_at": "2026-01-01 09:00:00"
      }
    ],
    "total": 50,
    "page": 1,
    "pageSize": 10,
    "totalPages": 5
  }
}
```

**权限要求**: `user:list`

---

### 1.2 用户详情
**接口地址**: `GET /api/support/users/:id`

**响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "name": "张三",
    "phone": "13800138000",
    "province": "浙江省",
    "city": "杭州市",
    "district": "西湖区",
    "address": "文三路XXX号",
    "organization": {
      "id": 1,
      "name": "浙江大学"
    },
    "researchGroup": {
      "id": 1,
      "name": "生物医学研究组"
    },
    "status": 1,
    "auditStatus": 1,
    "rejectReason": null,
    "auditTime": "2026-01-05 10:00:00",
    "auditBy": {
      "id": 1,
      "username": "admin"
    },
    "created_at": "2026-01-01 09:00:00",
    "updated_at": "2026-01-05 10:00:00"
  }
}
```

**权限要求**: `user:detail`

---

### 1.3 新增用户
**接口地址**: `POST /api/support/users`

**请求参数**:
```json
{
  "name": "李四",                    // 必填，姓名
  "phone": "13900139000",           // 必填，手机号（11位）
  "province": "浙江省",             // 必填，省份
  "city": "杭州市",                 // 必填，城市
  "district": "西湖区",             // 必填，区县
  "address": "文三路XXX号",         // 必填，详细地址
  "organizationId": 1,              // 必填，组织机构ID
  "researchGroupId": 1,             // 必填，课题组ID
  "auditStatus": 1                  // 可选，审核状态，默认1（审核通过）
}
```

**响应数据**:
```json
{
  "code": 200,
  "message": "创建成功",
  "data": {
    "id": 10,
    "name": "李四",
    "phone": "13900139000",
    "status": 1,
    "auditStatus": 1,
    "created_at": "2026-01-07 16:00:00"
  }
}
```

**业务逻辑**:
1. 验证手机号格式和唯一性
2. 验证组织机构和课题组是否存在
3. 如果auditStatus为1，记录审核时间（audit_time）和审核人（audit_by，当前登录的管理员）
4. 创建用户

**权限要求**: `user:create`

---

### 1.4 编辑用户
**接口地址**: `PUT /api/support/users/:id`

**请求参数**:
```json
{
  "name": "李四",                    // 可选，姓名
  "phone": "13900139000",           // 可选，手机号
  "province": "浙江省",             // 可选，省份
  "city": "杭州市",                 // 可选，城市
  "district": "西湖区",             // 可选，区县
  "address": "文三路XXX号",         // 可选，详细地址
  "organizationId": 2,              // 可选，组织机构ID
  "researchGroupId": 2,             // 可选，课题组ID
  "status": 1                       // 可选，状态
}
```

**响应数据**:
```json
{
  "code": 200,
  "message": "更新成功",
  "data": null
}
```

**业务逻辑**:
1. 如果修改手机号，验证新手机号的唯一性
2. 如果修改组织机构或课题组，验证其存在性
3. 不能通过此接口修改审核状态

**权限要求**: `user:update`

---

### 1.5 删除用户
**接口地址**: `DELETE /api/support/users/:id`

**响应数据**:
```json
{
  "code": 200,
  "message": "删除成功",
  "data": null
}
```

**业务逻辑**:
1. 检查用户是否有未完成的订单，有则不允许删除
2. 物理删除用户记录

**权限要求**: `user:delete`

---

### 1.6 审核用户
**接口地址**: `PUT /api/support/users/:id/audit`

**请求参数**:
```json
{
  "status": 1,                    // 必填，审核状态：1-通过 2-拒绝
  "rejectReason": "拒绝原因"      // 拒绝时必填，拒绝原因
}
```

**响应数据**:
```json
{
  "code": 200,
  "message": "审核通过",  // 或 "审核拒绝"
  "data": null
}
```

**业务逻辑**:

**审核通过（status=1）**：
1. 检查用户当前审核状态是否为待审核
2. 更新审核状态为1（审核通过）
3. 记录审核时间和审核人（当前登录的管理员）

**审核拒绝（status=2）**：
1. 检查用户当前审核状态是否为待审核
2. 验证rejectReason是否提供
3. 更新审核状态为2（审核拒绝）
4. 记录拒绝原因（reject_reason）、审核时间（audit_time）和审核人（audit_by，当前登录的管理员）

**权限要求**: `user:audit`

**说明**: 统一审核接口，通过status参数区分通过/拒绝，减少接口数量，统一审核逻辑处理。

---

### 1.8 启用/禁用用户
**接口地址**: `PUT /api/support/users/:id/status`

**请求参数**:
```json
{
  "status": 0  // 必填，状态：0-禁用 1-启用
}
```

**响应数据**:
```json
{
  "code": 200,
  "message": "操作成功",
  "data": null
}
```

**业务逻辑**:
1. 更新用户状态
2. 禁用后用户无法登录

**权限要求**: `user:status`

---

## 2. 组织机构管理接口

### 2.1 组织机构列表
**接口地址**: `GET /api/support/organizations`

**请求参数**:
```json
{
  "page": 1,          // 页码
  "pageSize": 10,     // 每页数量
  "name": "浙江"      // 可选，机构名称模糊查询
}
```

**响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "list": [
      {
        "id": 1,
        "name": "浙江大学",
        "created_at": "2026-01-01 00:00:00"
      }
    ],
    "total": 10,
    "page": 1,
    "pageSize": 10,
    "totalPages": 1
  }
}
```

**权限要求**: `organization:list`

---

### 2.2 创建组织机构
**接口地址**: `POST /api/support/organizations`

**请求参数**:
```json
{
  "name": "复旦大学"  // 必填，机构名称
}
```

**响应数据**:
```json
{
  "code": 200,
  "message": "创建成功",
  "data": {
    "id": 5,
    "name": "复旦大学",
    "created_at": "2026-01-07 16:00:00"
  }
}
```

**业务逻辑**:
1. 验证机构名称唯一性

**权限要求**: `organization:create`

---

### 2.3 更新组织机构
**接口地址**: `PUT /api/support/organizations/:id`

**请求参数**:
```json
{
  "name": "复旦大学医学院"  // 必填，机构名称
}
```

**响应数据**:
```json
{
  "code": 200,
  "message": "更新成功",
  "data": null
}
```

**业务逻辑**:
1. 验证新机构名称唯一性

**权限要求**: `organization:update`

---

### 2.4 删除组织机构
**接口地址**: `DELETE /api/support/organizations/:id`

**响应数据**:
```json
{
  "code": 200,
  "message": "删除成功",
  "data": null
}
```

**业务逻辑**:
1. 检查是否有用户关联此机构，有则不允许删除
2. 检查是否有课题组关联此机构，有则不允许删除
3. 物理删除

**权限要求**: `organization:delete`

---

### 2.5 组织机构详情
**接口地址**: `GET /api/support/organizations/:id`

**响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "name": "浙江大学",
    "created_at": "2026-01-01 00:00:00",
    "updated_at": "2026-01-01 00:00:00"
  }
}
```

**权限要求**: `organization:detail`

---

### 2.6 获取组织机构选项列表
**接口地址**: `GET /api/support/organizations/options`

**响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 1,
      "name": "浙江大学"
    },
    {
      "id": 2,
      "name": "复旦大学"
    }
  ]
}
```

**说明**: 用于下拉选择器，返回所有组织机构

**权限要求**: 无（已登录即可）

---

## 3. 课题组管理接口

### 3.1 课题组列表
**接口地址**: `GET /api/support/research-groups`

**请求参数**:
```json
{
  "page": 1,              // 页码
  "pageSize": 10,         // 每页数量
  "name": "生物",         // 可选，课题组名称模糊查询
  "organizationId": 1     // 可选，所属组织机构ID筛选
}
```

**响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "list": [
      {
        "id": 1,
        "name": "生物医学研究组",
        "organization": {
          "id": 1,
          "name": "浙江大学"
        },
        "created_at": "2026-01-01 00:00:00"
      }
    ],
    "total": 20,
    "page": 1,
    "pageSize": 10,
    "totalPages": 2
  }
}
```

**权限要求**: `research_group:list`

---

### 3.2 创建课题组
**接口地址**: `POST /api/support/research-groups`

**请求参数**:
```json
{
  "name": "神经科学研究组",    // 必填，课题组名称
  "organizationId": 1          // 必填，所属组织机构ID
}
```

**响应数据**:
```json
{
  "code": 200,
  "message": "创建成功",
  "data": {
    "id": 10,
    "name": "神经科学研究组",
    "organizationId": 1,
    "created_at": "2026-01-07 16:00:00"
  }
}
```

**业务逻辑**:
1. 验证组织机构是否存在
2. 验证课题组名称在同一组织机构下的唯一性

**权限要求**: `research_group:create`

---

### 3.3 更新课题组
**接口地址**: `PUT /api/support/research-groups/:id`

**请求参数**:
```json
{
  "name": "认知神经科学研究组",  // 可选，课题组名称
  "organizationId": 2            // 可选，所属组织机构ID
}
```

**响应数据**:
```json
{
  "code": 200,
  "message": "更新成功",
  "data": null
}
```

**业务逻辑**:
1. 如果修改组织机构，验证新组织机构是否存在
2. 验证课题组名称在新组织机构下的唯一性

**权限要求**: `research_group:update`

---

### 3.4 删除课题组
**接口地址**: `DELETE /api/support/research-groups/:id`

**响应数据**:
```json
{
  "code": 200,
  "message": "删除成功",
  "data": null
}
```

**业务逻辑**:
1. 检查是否有用户关联此课题组，有则不允许删除
2. 物理删除

**权限要求**: `research_group:delete`

---

### 3.5 课题组详情
**接口地址**: `GET /api/support/research-groups/:id`

**响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "name": "生物医学研究组",
    "organization": {
      "id": 1,
      "name": "浙江大学"
    },
    "created_at": "2026-01-01 00:00:00",
    "updated_at": "2026-01-01 00:00:00"
  }
}
```

**权限要求**: `research_group:detail`

---

### 3.6 根据组织机构获取课题组选项列表
**接口地址**: `GET /api/support/research-groups/options`

**请求参数**:
```json
{
  "organizationId": 1  // 必填，组织机构ID
}
```

**响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 1,
      "name": "生物医学研究组"
    },
    {
      "id": 2,
      "name": "化学研究组"
    }
  ]
}
```

**说明**: 用于下拉选择器，根据组织机构获取其下的课题组列表

**权限要求**: 无（已登录即可）

