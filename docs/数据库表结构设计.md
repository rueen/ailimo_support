# Ailimo Service - 数据库表结构设计

## 1. 用户相关表

### 1.1 users (用户表)
```sql
CREATE TABLE `users` (
  `id` INT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '用户ID',
  `user_no` VARCHAR(20) NOT NULL UNIQUE COMMENT '用户编号',
  `name` VARCHAR(50) NOT NULL COMMENT '姓名',
  `phone` VARCHAR(11) NOT NULL UNIQUE COMMENT '手机号',
  `province_id` INT UNSIGNED DEFAULT NULL COMMENT '省份ID',
  `city_id` INT UNSIGNED DEFAULT NULL COMMENT '城市ID',
  `district_id` INT UNSIGNED DEFAULT NULL COMMENT '区县ID',
  `address` VARCHAR(200) DEFAULT NULL COMMENT '详细地址',
  `organization_id` INT UNSIGNED DEFAULT NULL COMMENT '所属组织机构ID',
  `research_group_id` INT UNSIGNED DEFAULT NULL COMMENT '所属课题组ID',
  `status` TINYINT DEFAULT 1 COMMENT '状态：0-禁用 1-启用',
  `audit_status` TINYINT DEFAULT 0 COMMENT '审核状态：0-待审核 1-审核通过 2-审核拒绝',
  `reject_reason` VARCHAR(500) DEFAULT NULL COMMENT '拒绝原因',
  `audit_time` DATETIME DEFAULT NULL COMMENT '审核时间',
  `audit_by` INT UNSIGNED DEFAULT NULL COMMENT '审核人ID（管理员）',
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  INDEX `idx_user_no` (`user_no`),
  INDEX `idx_phone` (`phone`),
  INDEX `idx_province` (`province_id`),
  INDEX `idx_city` (`city_id`),
  INDEX `idx_district` (`district_id`),
  INDEX `idx_organization` (`organization_id`),
  INDEX `idx_research_group` (`research_group_id`),
  INDEX `idx_audit_status` (`audit_status`),
  INDEX `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='用户表';
```

### 1.2 organizations (组织机构表)
```sql
CREATE TABLE `organizations` (
  `id` INT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '组织机构ID',
  `name` VARCHAR(100) NOT NULL COMMENT '组织机构名称',
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  UNIQUE KEY `uk_name` (`name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='组织机构表';
```

### 1.3 research_groups (课题组表)
```sql
CREATE TABLE `research_groups` (
  `id` INT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '课题组ID',
  `name` VARCHAR(100) NOT NULL COMMENT '课题组名称',
  `organization_id` INT UNSIGNED NOT NULL COMMENT '所属组织机构ID',
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  INDEX `idx_organization` (`organization_id`),
  UNIQUE KEY `uk_name_org` (`name`, `organization_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='课题组表';
```

## 2. 设备预约相关表

### 2.1 equipment (设备表)
```sql
CREATE TABLE `equipment` (
  `id` INT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '设备ID',
  `name` VARCHAR(100) NOT NULL COMMENT '设备名称',
  `details` JSON DEFAULT NULL COMMENT '设备详情（JSON格式）',
  `status` TINYINT DEFAULT 1 COMMENT '状态：0-禁用 1-启用',
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  INDEX `idx_name` (`name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='设备表';
```

### 2.2 equipment_reservations (设备预约订单表)
```sql
CREATE TABLE `equipment_reservations` (
  `id` INT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '订单ID',
  `order_sn` VARCHAR(20) NOT NULL UNIQUE COMMENT '订单号',
  `source` TINYINT NOT NULL DEFAULT 0 COMMENT '订单来源：0-用户创建 1-管理员创建',
  `created_by_admin_id` INT UNSIGNED DEFAULT NULL COMMENT '创建管理员ID（仅管理员创建时有值）',
  `equipment_id` INT UNSIGNED NOT NULL COMMENT '设备ID',
  `user_id` INT UNSIGNED NOT NULL COMMENT '预约用户ID',
  `time_slots` JSON NOT NULL COMMENT '预约时间段数组（日期+时间段），格式：["2026-01-22 09:00-10:00", "2026-01-22 10:00-11:00", "2026-01-23 09:00-10:00"]，支持跨天预约',
  `status` TINYINT DEFAULT 0 COMMENT '状态：0-待审核 1-进行中 2-已拒绝 3-已完成 4-已取消',
  `remark` VARCHAR(500) DEFAULT NULL COMMENT '备注',
  `handler_id` INT UNSIGNED DEFAULT NULL COMMENT '负责人ID',
  `reject_reason` VARCHAR(500) DEFAULT NULL COMMENT '拒绝原因',
  `audit_time` DATETIME DEFAULT NULL COMMENT '审核时间',
  `audit_by` INT UNSIGNED DEFAULT NULL COMMENT '审核人ID',
  `completed_time` DATETIME DEFAULT NULL COMMENT '完成时间',
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  UNIQUE INDEX `idx_order_sn` (`order_sn`),
  INDEX `idx_equipment` (`equipment_id`),
  INDEX `idx_user` (`user_id`),
  INDEX `idx_status` (`status`),
  INDEX `idx_source` (`source`),
  INDEX `idx_created_by_admin` (`created_by_admin_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='设备预约订单表';
```

### 2.3 equipment_time_slots (设备预约时间段表)
```sql
CREATE TABLE `equipment_time_slots` (
  `id` INT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '时间段ID',
  `start_time` TIME NOT NULL COMMENT '开始时间',
  `end_time` TIME NOT NULL COMMENT '结束时间',
  `description` VARCHAR(200) DEFAULT NULL COMMENT '描述/备注',
  `status` TINYINT DEFAULT 1 COMMENT '状态：0-禁用 1-启用',
  `sort_order` INT DEFAULT 0 COMMENT '排序',
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='设备预约时间段表';
```

## 3. 笼位预约相关表

### 3.1 cages (笼位表)
```sql
CREATE TABLE `cages` (
  `id` INT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '笼位ID',
  `animal_type_id` INT UNSIGNED NOT NULL COMMENT '动物类型ID',
  `environment_id` INT UNSIGNED NOT NULL COMMENT '环境ID',
  `quantity` INT NOT NULL COMMENT '笼位数量',
  `status` TINYINT DEFAULT 1 COMMENT '状态：0-禁用 1-启用',
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  INDEX `idx_animal_type` (`animal_type_id`),
  INDEX `idx_environment` (`environment_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='笼位表';
```

### 3.2 cage_reservations (笼位预约订单表)
```sql
CREATE TABLE `cage_reservations` (
  `id` INT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '订单ID',
  `order_sn` VARCHAR(20) NOT NULL UNIQUE COMMENT '订单号',
  `source` TINYINT NOT NULL DEFAULT 0 COMMENT '订单来源：0-用户创建 1-管理员创建',
  `created_by_admin_id` INT UNSIGNED DEFAULT NULL COMMENT '创建管理员ID（仅管理员创建时有值）',
  `cage_id` INT UNSIGNED NOT NULL COMMENT '笼位ID',
  `user_id` INT UNSIGNED NOT NULL COMMENT '预约用户ID',
  `animal_type_id` INT UNSIGNED NOT NULL COMMENT '动物类型ID',
  `environment_id` INT UNSIGNED NOT NULL COMMENT '环境ID',
  `quantity` INT NOT NULL COMMENT '预约数量',
  `purpose_id` INT UNSIGNED NOT NULL COMMENT '用途ID',
  `reservation_date` DATE NOT NULL COMMENT '预约日期',
  `time_slots` JSON NOT NULL COMMENT '预约时间段数组（时间段快照），格式：["09:00-10:00", "10:00-11:00"]，存储用户选择的时间段字符串',
  `status` TINYINT DEFAULT 0 COMMENT '状态：0-待审核 1-进行中 2-已拒绝 3-已完成 4-已取消',
  `remark` VARCHAR(500) DEFAULT NULL COMMENT '备注',
  `handler_id` INT UNSIGNED DEFAULT NULL COMMENT '负责人ID',
  `reject_reason` VARCHAR(500) DEFAULT NULL COMMENT '拒绝原因',
  `audit_time` DATETIME DEFAULT NULL COMMENT '审核时间',
  `audit_by` INT UNSIGNED DEFAULT NULL COMMENT '审核人ID',
  `completed_time` DATETIME DEFAULT NULL COMMENT '完成时间',
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  UNIQUE INDEX `idx_order_sn` (`order_sn`),
  INDEX `idx_cage` (`cage_id`),
  INDEX `idx_user` (`user_id`),
  INDEX `idx_date` (`reservation_date`),
  INDEX `idx_status` (`status`),
  INDEX `idx_source` (`source`),
  INDEX `idx_created_by_admin` (`created_by_admin_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='笼位预约订单表';
```

### 3.3 cage_purposes (笼位用途表)
```sql
CREATE TABLE `cage_purposes` (
  `id` INT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '用途ID',
  `name` VARCHAR(100) NOT NULL COMMENT '用途名称',
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  UNIQUE KEY `uk_name` (`name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='笼位用途表';
```

### 3.4 cage_time_slots (笼位预约时间段表)
```sql
CREATE TABLE `cage_time_slots` (
  `id` INT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '时间段ID',
  `start_time` TIME NOT NULL COMMENT '开始时间',
  `end_time` TIME NOT NULL COMMENT '结束时间',
  `description` VARCHAR(200) DEFAULT NULL COMMENT '描述/备注',
  `status` TINYINT DEFAULT 1 COMMENT '状态：0-禁用 1-启用',
  `sort_order` INT DEFAULT 0 COMMENT '排序',
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='笼位预约时间段表';
```

## 4. 实验代操作相关表

### 4.1 operation_contents (操作内容表)
```sql
CREATE TABLE `operation_contents` (
  `id` INT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '操作内容ID',
  `name` VARCHAR(100) NOT NULL COMMENT '操作内容名称',
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  UNIQUE KEY `uk_name` (`name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='操作内容表';
```

### 4.2 experiment_operations (实验代操作订单表)
```sql
CREATE TABLE `experiment_operations` (
  `id` INT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '订单ID',
  `order_sn` VARCHAR(20) NOT NULL UNIQUE COMMENT '订单号',
  `source` TINYINT NOT NULL DEFAULT 0 COMMENT '订单来源：0-用户创建 1-管理员创建',
  `created_by_admin_id` INT UNSIGNED DEFAULT NULL COMMENT '创建管理员ID（仅管理员创建时有值）',
  `operation_content_id` INT UNSIGNED NOT NULL COMMENT '操作内容ID',
  `animal_type_id` INT UNSIGNED NOT NULL COMMENT '动物类型ID',
  `quantity` INT NOT NULL COMMENT '动物数量',
  `user_id` INT UNSIGNED NOT NULL COMMENT '预约用户ID',
  `time_slots` JSON NOT NULL COMMENT '预约时间段数组（日期+时间段），格式：["2026-01-22 09:00-12:00", "2026-01-22 13:00-18:00", "2026-01-23 09:00-12:00"]，支持跨天预约',
  `status` TINYINT DEFAULT 0 COMMENT '状态：0-待审核 1-进行中 2-已拒绝 3-已完成 4-已取消',
  `remark` VARCHAR(500) DEFAULT NULL COMMENT '备注',
  `handler_id` INT UNSIGNED DEFAULT NULL COMMENT '负责人ID',
  `reject_reason` VARCHAR(500) DEFAULT NULL COMMENT '拒绝原因',
  `audit_time` DATETIME DEFAULT NULL COMMENT '审核时间',
  `audit_by` INT UNSIGNED DEFAULT NULL COMMENT '审核人ID',
  `completed_time` DATETIME DEFAULT NULL COMMENT '完成时间',
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  UNIQUE INDEX `idx_order_sn` (`order_sn`),
  INDEX `idx_operation` (`operation_content_id`),
  INDEX `idx_user` (`user_id`),
  INDEX `idx_status` (`status`),
  INDEX `idx_source` (`source`),
  INDEX `idx_created_by_admin` (`created_by_admin_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='实验代操作订单表';
```

### 4.3 experiment_time_slots (实验代操作时间段表)
```sql
CREATE TABLE `experiment_time_slots` (
  `id` INT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '时间段ID',
  `start_time` TIME NOT NULL COMMENT '开始时间',
  `end_time` TIME NOT NULL COMMENT '结束时间',
  `description` VARCHAR(200) DEFAULT NULL COMMENT '描述/备注',
  `status` TINYINT DEFAULT 1 COMMENT '状态：0-禁用 1-启用',
  `sort_order` INT DEFAULT 0 COMMENT '排序',
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='实验代操作时间段表';
```

## 5. 动物订购相关表

### 5.1 animal_brands (动物品牌表)
```sql
CREATE TABLE `animal_brands` (
  `id` INT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '品牌ID',
  `name` VARCHAR(100) NOT NULL COMMENT '品牌名称',
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  UNIQUE KEY `uk_name` (`name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='动物品牌表';
```

### 5.2 animal_varieties (动物种类/品系表)
```sql
CREATE TABLE `animal_varieties` (
  `id` INT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '种类ID',
  `name` VARCHAR(100) NOT NULL COMMENT '种类/品系名称',
  `brand_id` INT UNSIGNED NOT NULL COMMENT '所属品牌ID',
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  INDEX `idx_brand` (`brand_id`),
  UNIQUE KEY `uk_name_brand` (`name`, `brand_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='动物种类/品系表';
```

### 5.3 animal_specifications (动物规格表)
```sql
CREATE TABLE `animal_specifications` (
  `id` INT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '规格ID',
  `name` VARCHAR(100) NOT NULL COMMENT '规格名称',
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  UNIQUE KEY `uk_name` (`name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='动物规格表';
```

### 5.4 animal_requirements (动物要求表)
```sql
CREATE TABLE `animal_requirements` (
  `id` INT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '要求ID',
  `name` VARCHAR(100) NOT NULL COMMENT '要求名称',
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  UNIQUE KEY `uk_name` (`name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='动物要求表';
```

### 5.5 animal_orders (动物订购订单表)
```sql
CREATE TABLE `animal_orders` (
  `id` INT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '订单ID',
  `order_sn` VARCHAR(20) NOT NULL UNIQUE COMMENT '订单号',
  `source` TINYINT NOT NULL DEFAULT 0 COMMENT '订单来源：0-用户创建 1-管理员创建',
  `created_by_admin_id` INT UNSIGNED DEFAULT NULL COMMENT '创建管理员ID（仅管理员创建时有值）',
  `brand_id` INT UNSIGNED NOT NULL COMMENT '品牌ID',
  `variety_id` INT UNSIGNED NOT NULL COMMENT '种类/品系ID',
  `specification_id` INT UNSIGNED NOT NULL COMMENT '规格ID',
  `gender` TINYINT NOT NULL COMMENT '性别：0-雌性 1-雄性 2-不限',
  `supervisor_name` VARCHAR(50) NOT NULL COMMENT '导师姓名',
  `orderer_name` VARCHAR(50) NOT NULL COMMENT '订购人姓名',
  `contact_phone` VARCHAR(11) NOT NULL COMMENT '联系电话',
  `delivery_date` DATE NOT NULL COMMENT '到货日期',
  `province_id` INT UNSIGNED NOT NULL COMMENT '省份ID',
  `city_id` INT UNSIGNED NOT NULL COMMENT '城市ID',
  `district_id` INT UNSIGNED NOT NULL COMMENT '区县ID',
  `address` VARCHAR(200) NOT NULL COMMENT '详细地址',
  `environment_id` INT UNSIGNED NOT NULL COMMENT '环境ID',
  `requirement_id` INT UNSIGNED NOT NULL COMMENT '要求ID',
  `user_id` INT UNSIGNED NOT NULL COMMENT '用户ID',
  `status` TINYINT DEFAULT 0 COMMENT '状态：0-待处理 1-进行中 2-已拒绝 3-已完成 4-已取消',
  `remark` VARCHAR(500) DEFAULT NULL COMMENT '备注',
  `handler_id` INT UNSIGNED DEFAULT NULL COMMENT '负责人ID',
  `reject_reason` VARCHAR(500) DEFAULT NULL COMMENT '拒绝原因',
  `audit_time` DATETIME DEFAULT NULL COMMENT '审核时间',
  `audit_by` INT UNSIGNED DEFAULT NULL COMMENT '审核人ID',
  `completed_time` DATETIME DEFAULT NULL COMMENT '完成时间',
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  UNIQUE INDEX `idx_order_sn` (`order_sn`),
  INDEX `idx_brand` (`brand_id`),
  INDEX `idx_user` (`user_id`),
  INDEX `idx_province` (`province_id`),
  INDEX `idx_city` (`city_id`),
  INDEX `idx_district` (`district_id`),
  INDEX `idx_status` (`status`),
  INDEX `idx_delivery_date` (`delivery_date`),
  INDEX `idx_source` (`source`),
  INDEX `idx_created_by_admin` (`created_by_admin_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='动物订购订单表';
```

## 6. 试剂耗材订购相关表

### 6.1 reagent_brands (试剂耗材品牌表)
```sql
CREATE TABLE `reagent_brands` (
  `id` INT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '品牌ID',
  `name` VARCHAR(100) NOT NULL COMMENT '品牌名称',
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  UNIQUE KEY `uk_name` (`name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='试剂耗材品牌表';
```

### 6.2 reagent_specifications (试剂耗材规格表)
```sql
CREATE TABLE `reagent_specifications` (
  `id` INT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '规格ID',
  `name` VARCHAR(100) NOT NULL COMMENT '规格名称',
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  UNIQUE KEY `uk_name` (`name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='试剂耗材规格表';
```

### 6.3 reagent_orders (试剂耗材订购订单表)
```sql
CREATE TABLE `reagent_orders` (
  `id` INT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '订单ID',
  `order_sn` VARCHAR(20) NOT NULL UNIQUE COMMENT '订单号',
  `source` TINYINT NOT NULL DEFAULT 0 COMMENT '订单来源：0-用户创建 1-管理员创建',
  `created_by_admin_id` INT UNSIGNED DEFAULT NULL COMMENT '创建管理员ID（仅管理员创建时有值）',
  `name` VARCHAR(200) NOT NULL COMMENT '试剂耗材名称',
  `brand_id` INT UNSIGNED NOT NULL COMMENT '品牌ID',
  `specification_id` INT UNSIGNED NOT NULL COMMENT '规格ID',
  `quantity` INT NOT NULL COMMENT '数量',
  `orderer_name` VARCHAR(50) NOT NULL COMMENT '订购人姓名',
  `contact_phone` VARCHAR(11) NOT NULL COMMENT '联系电话',
  `delivery_date` DATE NOT NULL COMMENT '到货日期',
  `province_id` INT UNSIGNED NOT NULL COMMENT '省份ID',
  `city_id` INT UNSIGNED NOT NULL COMMENT '城市ID',
  `district_id` INT UNSIGNED NOT NULL COMMENT '区县ID',
  `address` VARCHAR(200) NOT NULL COMMENT '详细地址',
  `user_id` INT UNSIGNED NOT NULL COMMENT '用户ID',
  `status` TINYINT DEFAULT 0 COMMENT '状态：0-待处理 1-进行中 2-已拒绝 3-已完成 4-已取消',
  `remark` VARCHAR(500) DEFAULT NULL COMMENT '备注',
  `handler_id` INT UNSIGNED DEFAULT NULL COMMENT '负责人ID',
  `reject_reason` VARCHAR(500) DEFAULT NULL COMMENT '拒绝原因',
  `audit_time` DATETIME DEFAULT NULL COMMENT '审核时间',
  `audit_by` INT UNSIGNED DEFAULT NULL COMMENT '审核人ID',
  `completed_time` DATETIME DEFAULT NULL COMMENT '完成时间',
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  UNIQUE INDEX `idx_order_sn` (`order_sn`),
  INDEX `idx_brand` (`brand_id`),
  INDEX `idx_user` (`user_id`),
  INDEX `idx_province` (`province_id`),
  INDEX `idx_city` (`city_id`),
  INDEX `idx_district` (`district_id`),
  INDEX `idx_status` (`status`),
  INDEX `idx_delivery_date` (`delivery_date`),
  INDEX `idx_source` (`source`),
  INDEX `idx_created_by_admin` (`created_by_admin_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='试剂耗材订购订单表';
```

## 7. 案例管理表

### 7.1 cases (案例表)
```sql
CREATE TABLE `cases` (
  `id` INT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '案例ID',
  `project_name` VARCHAR(200) NOT NULL COMMENT '项目名称',
  `project_summary` TEXT COMMENT '项目概述',
  `project_result` TEXT COMMENT '项目成果',
  `images` JSON DEFAULT NULL COMMENT '案例图片数组（OSS地址）',
  `status` TINYINT DEFAULT 1 COMMENT '状态：0-禁用 1-启用',
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  INDEX `idx_project_name` (`project_name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='案例表';
```

## 8. 公司信息表

### 8.1 company_info (公司信息表)
```sql
CREATE TABLE `company_info` (
  `id` INT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '公司信息ID（固定为1）',
  `content` JSON NOT NULL COMMENT '公司信息内容（JSON格式）',
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='公司信息表';
```

**说明：**
- 公司信息只有一条记录（id=1）
- 所有字段以 JSON 格式存储在 `content` 字段中
- 前端可根据需求自由扩展字段，无需修改表结构

**JSON 内容示例：**
```json
{
  "company_name": "XXX生物科技有限公司",
  "company_address": "XXX省XXX市XXX区XXX路XXX号",
  "contact_phone": "400-XXX-XXXX",
  "email": "contact@example.com",
  "work_time": "周一至周五 9:00-18:00",
  "company_intro": "公司简介内容...",
  "service_concept": "我们的服务理念...",
  "banner_image": [],
  "video_url": "https://example.com/logo.mp4",
}
```

## 9. 管理员管理表

### 9.1 administrators (管理员表)
```sql
CREATE TABLE `administrators` (
  `id` INT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '管理员ID',
  `username` VARCHAR(50) NOT NULL UNIQUE COMMENT '用户名',
  `password` VARCHAR(255) NOT NULL COMMENT '密码（bcrypt加密）',
  `remark` VARCHAR(200) DEFAULT NULL COMMENT '备注',
  `role_id` INT UNSIGNED DEFAULT NULL COMMENT '角色ID',
  `status` TINYINT DEFAULT 1 COMMENT '状态：0-禁用 1-启用',
  `last_login_time` DATETIME DEFAULT NULL COMMENT '最后登录时间',
  `last_login_ip` VARCHAR(50) DEFAULT NULL COMMENT '最后登录IP',
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  INDEX `idx_username` (`username`),
  INDEX `idx_role` (`role_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='管理员表';
```

### 9.2 roles (角色表)
```sql
CREATE TABLE `roles` (
  `id` INT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '角色ID',
  `name` VARCHAR(50) NOT NULL UNIQUE COMMENT '角色名称',
  `description` VARCHAR(200) DEFAULT NULL COMMENT '角色描述',
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='角色表';
```

### 9.3 permissions (权限表)
```sql
CREATE TABLE `permissions` (
  `id` INT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '权限ID',
  `name` VARCHAR(100) NOT NULL COMMENT '权限名称',
  `code` VARCHAR(100) NOT NULL UNIQUE COMMENT '权限代码（格式：模块:操作，如 user:list）',
  `parent_id` INT UNSIGNED DEFAULT 0 COMMENT '父级权限ID（0表示顶级）',
  `sort_order` INT DEFAULT 0 COMMENT '排序',
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  INDEX `idx_code` (`code`),
  INDEX `idx_parent` (`parent_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='权限表';
```

**说明**：
- 权限代码格式：`模块:操作`，如 `user:list`、`cage:create`
- 一级权限（模块）的 `parent_id` 为 0，如 `dashboard`、`user`
- 二级权限（操作）的 `parent_id` 为其所属模块的 id
- 所有权限通过 `scripts/generate-permissions.js` 脚本批量生成
- 不支持前端手动创建、编辑权限

### 9.4 role_permissions (角色权限关联表)
```sql
CREATE TABLE `role_permissions` (
  `id` INT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT 'ID',
  `role_id` INT UNSIGNED NOT NULL COMMENT '角色ID',
  `permission_id` INT UNSIGNED NOT NULL COMMENT '权限ID',
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  UNIQUE KEY `uk_role_permission` (`role_id`, `permission_id`),
  INDEX `idx_role` (`role_id`),
  INDEX `idx_permission` (`permission_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='角色权限关联表';
```

## 10. 地区管理表

### 10.1 regions (地区表)
```sql
CREATE TABLE `regions` (
  `id` INT UNSIGNED PRIMARY KEY COMMENT '地区ID（使用国标区划代码）',
  `name` VARCHAR(100) NOT NULL COMMENT '地区名称',
  `code` VARCHAR(20) NOT NULL COMMENT '地区代码（国标区划代码）',
  `parent_id` INT UNSIGNED DEFAULT 0 COMMENT '父级地区ID（0表示顶级）',
  `level` TINYINT NOT NULL COMMENT '层级：1-省份 2-城市 3-区县',
  `sort_order` INT DEFAULT 0 COMMENT '排序',
  `status` TINYINT DEFAULT 1 COMMENT '状态：0-禁用 1-启用',
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  INDEX `idx_parent` (`parent_id`),
  INDEX `idx_code` (`code`),
  INDEX `idx_level` (`level`),
  INDEX `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='地区表（省市区三级联动）';
```

**说明**：
- `id` 直接使用国标区划代码作为主键（不使用AUTO_INCREMENT）
- `code` 存储国标区划代码，便于数据更新和维护
- `parent_id` 建立地区层级关系：省份的parent_id=0，城市的parent_id=省份id，区县的parent_id=城市id
- `level` 标识地区层级，便于查询和筛选
- `sort_order` 用于同级地区的排序显示
- 数据来源：使用国家统计局最新省市区数据

**数据示例**：
```sql
-- 省级（level=1, parent_id=0）
INSERT INTO regions VALUES (110000, '北京市', '11', 0, 1, 1, 1, NOW(), NOW());

-- 市级（level=2, parent_id=省id）
INSERT INTO regions VALUES (110100, '市辖区', '1101', 110000, 2, 1, 1, NOW(), NOW());

-- 区县级（level=3, parent_id=市id）
INSERT INTO regions VALUES (110101, '东城区', '110101', 110100, 3, 1, 1, NOW(), NOW());
INSERT INTO regions VALUES (110102, '西城区', '110102', 110100, 3, 2, 1, NOW(), NOW());
```

## 11. 通用配置表

### 11.1 environment_types (环境类型表)
```sql
CREATE TABLE `environment_types` (
  `id` INT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '环境类型ID',
  `name` VARCHAR(50) NOT NULL COMMENT '环境名称',
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  UNIQUE KEY `uk_name` (`name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='环境类型表';
```

### 11.2 animal_types (动物类型表)
```sql
CREATE TABLE `animal_types` (
  `id` INT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '动物类型ID',
  `name` VARCHAR(50) NOT NULL COMMENT '动物类型名称',
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  UNIQUE KEY `uk_name` (`name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='动物类型表';
```

### 11.3 handlers (负责人表)
```sql
CREATE TABLE `handlers` (
  `id` INT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '负责人ID',
  `name` VARCHAR(50) NOT NULL COMMENT '负责人姓名',
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
  UNIQUE KEY `uk_name` (`name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='负责人表';
```

**说明**：负责人用于订单的执行人分配，与管理员（administrators）独立维护

## 12. 系统配置表

### 12.1 system_configs (系统配置表)
```sql
CREATE TABLE `system_configs` (
  `id` INT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '配置ID',
  `config_key` VARCHAR(100) NOT NULL UNIQUE COMMENT '配置键',
  `config_value` TEXT COMMENT '配置值',
  `description` VARCHAR(200) DEFAULT NULL COMMENT '配置描述',
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `updated_at` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='系统配置表';
```

**说明**：用于存储系统级配置，包括：
- OSS配置（oss_config）
- 短信配置（sms_config）
- 提前预约天数配置：
  - equipment_advance_days：设备预约提前预约天数
  - cage_advance_days：笼位预约提前预约天数
  - experiment_advance_days：实验代操作提前预约天数

## 13. 短信验证码表

### 13.1 sms_codes (短信验证码表)
```sql
CREATE TABLE `sms_codes` (
  `id` INT UNSIGNED AUTO_INCREMENT PRIMARY KEY COMMENT '验证码ID',
  `phone` VARCHAR(11) NOT NULL COMMENT '手机号',
  `code` VARCHAR(6) NOT NULL COMMENT '验证码',
  `type` TINYINT NOT NULL COMMENT '类型：1-登录 2-注册',
  `is_used` TINYINT DEFAULT 0 COMMENT '是否已使用：0-未使用 1-已使用',
  `expire_time` DATETIME NOT NULL COMMENT '过期时间',
  `created_at` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  INDEX `idx_phone` (`phone`),
  INDEX `idx_expire` (`expire_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='短信验证码表';
```

## 数据库初始化说明

### 1. 默认管理员账号
```sql
INSERT INTO `administrators` (`username`, `password`, `remark`, `role_id`, `status`) 
VALUES ('admin', '$2b$10$encrypted_password_here', '系统管理员', 1, 1);
```
**注意**：password字段需要使用bcrypt加密后的"123456"

### 2. 默认角色
```sql
INSERT INTO `roles` (`id`, `name`, `description`) VALUES
(1, '超级管理员', '拥有所有权限'),
(2, '设备管理员', '负责设备预约管理'),
(3, '笼位管理员', '负责笼位预约管理'),
(4, '实验操作管理员', '负责实验代操作管理'),
(5, '订购管理员', '负责动物和试剂订购管理');
```

### 3. 默认时间段配置
```sql
-- 设备预约时间段（09:00-18:00，每小时一个时段）
INSERT INTO `equipment_time_slots` (`start_time`, `end_time`, `description`, `status`, `sort_order`) VALUES
('09:00:00', '10:00:00', '', 1, 1),
('10:00:00', '11:00:00', '', 1, 2),
('11:00:00', '12:00:00', '', 1, 3),
('12:00:00', '13:00:00', '', 1, 4),
('13:00:00', '14:00:00', '', 1, 5),
('14:00:00', '15:00:00', '', 1, 6),
('15:00:00', '16:00:00', '', 1, 7),
('16:00:00', '17:00:00', '', 1, 8),
('17:00:00', '18:00:00', '', 1, 9);

-- 笼位预约时间段（与设备预约相同）
INSERT INTO `cage_time_slots` (`start_time`, `end_time`, `description`, `status`, `sort_order`) VALUES
('09:00:00', '10:00:00', '', 1, 1),
('10:00:00', '11:00:00', '', 1, 2),
('11:00:00', '12:00:00', '', 1, 3),
('12:00:00', '13:00:00', '', 1, 4),
('13:00:00', '14:00:00', '', 1, 5),
('14:00:00', '15:00:00', '', 1, 6),
('15:00:00', '16:00:00', '', 1, 7),
('16:00:00', '17:00:00', '', 1, 8),
('17:00:00', '18:00:00', '', 1, 9);

-- 实验代操作时间段
INSERT INTO `experiment_time_slots` (`start_time`, `end_time`, `description`, `status`, `sort_order`) VALUES
('09:00:00', '12:00:00', '上午时段', 1, 1),
('13:00:00', '18:00:00', '下午时段', 1, 2),
('18:00:00', '24:00:00', '晚上时段（加班时间需额外付加班费）', 1, 3);
```

### 4. 默认系统配置（提前预约天数）
```sql
INSERT INTO `system_configs` (`config_key`, `config_value`, `description`) VALUES
('equipment_advance_days', '7', '设备预约提前预约天数（单位：天）'),
('cage_advance_days', '7', '笼位预约提前预约天数（单位：天）'),
('experiment_advance_days', '7', '实验代操作提前预约天数（单位：天）');
```

### 5. 默认公司信息
```sql
INSERT INTO `company_info` (`id`, `content`) VALUES (
  1, 
  JSON_OBJECT(
    'company_name', '',
    'company_address', '',
    'contact_phone', '',
    'email', '',
    'work_time', '',
    'company_intro', '',
    'service_concept', '',
    'banner_image', JSON_ARRAY(),
    'video_url', ''
  )
);
```

## 表关系说明

### 用户模块
- `users` → `organizations` (多对一)
- `users` → `research_groups` (多对一)
- `users` → `regions` (多对一，province_id/city_id/district_id)
- `research_groups` → `organizations` (多对一)

### 订单模块
- 所有订单表 → `users` (多对一，user_id字段)
- 所有订单表 → `handlers` (多对一，handler_id字段：订单负责人)
- 所有订单表 → `administrators` (多对一，audit_by字段：审核人)
- `users` → `administrators` (多对一，audit_by字段：用户审核人)

### 设备预约
- `equipment_reservations` → `equipment` (多对一)

### 笼位预约
- `cage_reservations` → `cages` (多对一)
- `cage_reservations` → `cage_purposes` (多对一)
- `cages` → `animal_types` (多对一)
- `cages` → `environment_types` (多对一)

### 实验代操作
- `experiment_operations` → `operation_contents` (多对一)
- `experiment_operations` → `animal_types` (多对一)

### 动物订购
- `animal_orders` → `animal_brands` (多对一)
- `animal_orders` → `animal_varieties` (多对一)
- `animal_orders` → `animal_specifications` (多对一)
- `animal_orders` → `animal_requirements` (多对一)
- `animal_orders` → `environment_types` (多对一)
- `animal_orders` → `regions` (多对一，province_id/city_id/district_id)
- `animal_varieties` → `animal_brands` (多对一)

### 试剂耗材订购
- `reagent_orders` → `reagent_brands` (多对一)
- `reagent_orders` → `reagent_specifications` (多对一)
- `reagent_orders` → `regions` (多对一，province_id/city_id/district_id)

### 权限管理
- `administrators` → `roles` (多对一)
- `roles` → `permissions` (多对多，通过role_permissions关联)

## 索引说明

所有表都创建了必要的索引以优化查询性能：
- 主键索引（PRIMARY KEY）
- 唯一索引（UNIQUE KEY）：防止重复数据
- 普通索引（INDEX）：加速常用查询条件
- 外键关联字段索引：提升JOIN查询性能

## 字段类型说明

- **INT UNSIGNED**：无符号整数，用于ID和数量字段
- **VARCHAR**：变长字符串，用于文本字段
- **TEXT**：大文本字段，用于长文本内容
- **JSON**：JSON格式数据，用于复杂结构数据
- **TINYINT**：微整数，用于状态、标志位
- **DATE**：日期类型
- **TIME**：时间类型
- **DATETIME**：日期时间类型

## 字符集说明

所有表使用 `utf8mb4` 字符集，支持完整的Unicode字符，包括emoji表情。

