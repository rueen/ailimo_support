# 管理端接口 - 内容管理

## 基础路径
```
/api/support
```

## 1. 案例管理接口

### 1.1 案例列表
**接口地址**: `GET /api/support/cases`

**请求参数**:
```json
{
  "page": 1,                  // 页码
  "page_size": 10,             // 每页数量
  "project_name": "肿瘤",      // 可选，项目名称模糊查询
  "project_summary": "研究",   // 可选，项目概述模糊查询
  "status": 1                 // 可选，状态筛选：0-禁用 1-启用
}
```

**响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "list": [
      {
        "id": 1,
        "project_name": "肿瘤免疫治疗研究",
        "project_summary": "针对多种肿瘤的免疫治疗方法研究...",
        "project_result": "成功开发出新型免疫治疗方案...",
        "images": [
          "https://oss.example.com/case1_1.jpg",
          "https://oss.example.com/case1_2.jpg"
        ],
        "status": 1,
        "created_at": "2026-01-01 00:00:00"
      }
    ],
    "total": 20,
    "page": 1,
    "page_size": 10,
    "total_pages": 2
  }
}
```

**权限要求**: `case:list`

---

### 1.2 案例详情
**接口地址**: `GET /api/support/cases/:id`

**响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "project_name": "肿瘤免疫治疗研究",
    "project_summary": "针对多种肿瘤的免疫治疗方法研究，包括小鼠模型建立、药物筛选等。",
    "project_result": "成功开发出新型免疫治疗方案，在小鼠模型中显示出良好的抗肿瘤效果。",
    "images": [
      "https://oss.example.com/case1_1.jpg",
      "https://oss.example.com/case1_2.jpg"
    ],
    "status": 1,
    "created_at": "2026-01-01 00:00:00",
    "updated_at": "2026-01-01 00:00:00"
  }
}
```

**权限要求**: `case:detail`

---

### 1.3 创建案例
**接口地址**: `POST /api/support/cases`

**请求参数**:
```json
{
  "project_name": "肿瘤免疫治疗研究",                                      // 必填，项目名称
  "project_summary": "针对多种肿瘤的免疫治疗方法研究...",                  // 必填，项目概述
  "project_result": "成功开发出新型免疫治疗方案...",                       // 必填，项目成果
  "images": [                                                             // 可选，案例图片数组（OSS地址）
    "https://oss.example.com/case1_1.jpg",
    "https://oss.example.com/case1_2.jpg"
  ]
}
```

**响应数据**:
```json
{
  "code": 200,
  "message": "创建成功",
  "data": {
    "id": 10,
    "project_name": "肿瘤免疫治疗研究",
    "project_summary": "针对多种肿瘤的免疫治疗方法研究...",
    "project_result": "成功开发出新型免疫治疗方案...",
    "images": [...],
    "status": 1,
    "created_at": "2026-01-07 16:00:00"
  }
}
```

**业务逻辑**:
1. 验证项目名称不能为空
2. 验证图片URL格式（如果提供）
3. 创建案例

**权限要求**: `case:create`

---

### 1.4 更新案例
**接口地址**: `PUT /api/support/cases/:id`

**请求参数**:
```json
{
  "project_name": "肿瘤免疫治疗深度研究",                  // 可选，项目名称
  "project_summary": "更新后的项目概述...",               // 可选，项目概述
  "project_result": "更新后的项目成果...",                // 可选，项目成果
  "images": [                                            // 可选，案例图片数组
    "https://oss.example.com/case1_new.jpg"
  ],
  "status": 1                                            // 可选，状态
}
```

**响应数据**:
```json
{
  "code": 200,
  "message": "更新成功",
  "data": null
}
```

**权限要求**: `case:update`

---

### 1.5 删除案例
**接口地址**: `DELETE /api/support/cases/:id`

**响应数据**:
```json
{
  "code": 200,
  "message": "删除成功",
  "data": null
}
```

**业务逻辑**:
1. 物理删除案例记录

**权限要求**: `case:delete`

---

## 2. 公司信息管理接口

### 2.1 获取公司信息
**接口地址**: `GET /api/support/company-info`

**响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "company_name": "艾力默生物科技有限公司",
    "company_address": "浙江省杭州市西湖区文三路XXX号",
    "contact_phone": "0571-12345678",
    "email": "info@ailimo.com",
    "work_time": "周一至周五 9:00-18:00",
    "company_intro": "艾力默生物科技是一家专注于实验动物服务的公司...",
    "service_concept": "专业、高效、贴心的一站式实验动物服务",
    "updated_at": "2026-01-01 00:00:00"
  }
}
```

**说明**: 公司信息只有一条记录（id=1）

**权限要求**: `company_info:view`

---

### 2.2 更新公司信息
**接口地址**: `PUT /api/support/company-info`

**请求参数**:
```json
{
  "company_name": "艾力默生物科技有限公司",                          // 可选，公司名称
  "company_address": "浙江省杭州市西湖区文三路XXX号",               // 可选，公司地址
  "contact_phone": "0571-12345678",                                // 可选，联系电话
  "email": "info@ailimo.com",                                     // 可选，电子邮箱
  "work_time": "周一至周五 9:00-18:00",                            // 可选，工作时间
  "company_intro": "艾力默生物科技是一家专注于实验动物服务的公司...", // 可选，公司简介
  "service_concept": "专业、高效、贴心的一站式实验动物服务"          // 可选，服务理念
}
```

**响应数据**:
```json
{
  "code": 200,
  "message": "更新成功",
  "data": null
}
```

**业务逻辑**:
1. 验证邮箱格式（如果提供）
2. 如果id=1的记录不存在，则创建；否则更新

**权限要求**: `company_info:update`

---

## 3. 通用配置管理接口

### 3.1 负责人管理

#### 3.1.1 负责人列表
**接口地址**: `GET /api/support/handlers`

**请求参数**:
```json
{
  "page": 1,          // 页码
  "pageSize": 10,     // 每页数量
  "name": "张三"      // 可选，负责人姓名模糊查询
}
```

**响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "list": [
      {
        "id": 1,
        "name": "张三",
        "created_at": "2026-01-01 00:00:00"
      }
    ],
    "total": 10,
    "page": 1,
    "page_size": 10,
    "total_pages": 1
  }
}
```

**权限要求**: `handler:list`

---

#### 3.1.2 创建负责人
**接口地址**: `POST /api/support/handlers`

**请求参数**:
```json
{
  "name": "张三"  // 必填，负责人姓名
}
```

**响应数据**:
```json
{
  "code": 200,
  "message": "创建成功",
  "data": {
    "id": 5,
    "name": "张三",
    "created_at": "2026-01-07 16:00:00"
  }
}
```

**业务逻辑**:
1. 验证负责人姓名唯一性

**权限要求**: `handler:create`

---

#### 3.1.3 更新负责人
**接口地址**: `PUT /api/support/handlers/:id`

**请求参数**:
```json
{
  "name": "李四"  // 必填，负责人姓名
}
```

**响应数据**:
```json
{
  "code": 200,
  "message": "更新成功",
  "data": null
}
```

**业务逻辑**:
1. 验证新负责人姓名唯一性

**权限要求**: `handler:update`

---

#### 3.1.4 删除负责人
**接口地址**: `DELETE /api/support/handlers/:id`

**响应数据**:
```json
{
  "code": 200,
  "message": "删除成功",
  "data": null
}
```

**业务逻辑**:
1. 检查是否有订单使用此负责人，有则不允许删除
2. 物理删除

**权限要求**: `handler:delete`

---

#### 3.1.5 负责人详情
**接口地址**: `GET /api/support/handlers/:id`

**响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "name": "张三",
    "created_at": "2026-01-01 00:00:00",
    "updated_at": "2026-01-01 00:00:00"
  }
}
```

**权限要求**: `handler:detail`

---

#### 3.1.6 获取负责人选项列表
**接口地址**: `GET /api/support/handlers/options`

**响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 1,
      "name": "张三"
    },
    {
      "id": 2,
      "name": "李四"
    }
  ]
}
```

**说明**: 返回所有负责人，用于下拉选择（审核通过时选择负责人）

**权限要求**: 无（已登录即可）

---

### 3.2 环境类型管理

#### 3.2.1 环境类型列表
**接口地址**: `GET /api/support/environment-types`

**请求参数**:
```json
{
  "page": 1,          // 页码
  "pageSize": 10,     // 每页数量
  "name": "屏障"      // 可选，环境名称模糊查询
}
```

**响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "list": [
      {
        "id": 1,
        "name": "屏障环境",
        "created_at": "2026-01-01 00:00:00"
      },
      {
        "id": 2,
        "name": "非屏障环境",
        "created_at": "2026-01-01 00:00:00"
      }
    ],
    "total": 2,
    "page": 1,
    "page_size": 10,
    "total_pages": 1
  }
}
```

**权限要求**: `environment_type:list`

---

#### 3.2.2 创建环境类型
**接口地址**: `POST /api/support/environment-types`

**请求参数**:
```json
{
  "name": "屏障环境"  // 必填，环境名称
}
```

**响应数据**:
```json
{
  "code": 200,
  "message": "创建成功",
  "data": {
    "id": 3,
    "name": "屏障环境",
    "created_at": "2026-01-07 16:00:00"
  }
}
```

**业务逻辑**:
1. 验证环境名称唯一性

**权限要求**: `environment_type:create`

---

#### 3.2.3 更新环境类型
**接口地址**: `PUT /api/support/environment-types/:id`

**请求参数**:
```json
{
  "name": "SPF屏障环境"  // 必填，环境名称
}
```

**响应数据**:
```json
{
  "code": 200,
  "message": "更新成功",
  "data": null
}
```

**业务逻辑**:
1. 验证新环境名称唯一性

**权限要求**: `environment_type:update`

---

#### 3.2.4 删除环境类型
**接口地址**: `DELETE /api/support/environment-types/:id`

**响应数据**:
```json
{
  "code": 200,
  "message": "删除成功",
  "data": null
}
```

**业务逻辑**:
1. 检查是否有笼位、订单使用此环境类型，有则不允许删除
2. 物理删除

**权限要求**: `environment_type:delete`

---

#### 3.2.5 环境类型详情
**接口地址**: `GET /api/support/environment-types/:id`

**响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "name": "屏障环境",
    "created_at": "2026-01-01 00:00:00",
    "updated_at": "2026-01-01 00:00:00"
  }
}
```

**权限要求**: `environment_type:detail`

---

#### 3.2.6 获取环境类型选项列表
**接口地址**: `GET /api/support/environment-types/options`

**响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 1,
      "name": "屏障环境"
    },
    {
      "id": 2,
      "name": "非屏障环境"
    }
  ]
}
```

**说明**: 返回所有环境类型，用于下拉选择

**权限要求**: 无（已登录即可）

---

### 3.3 动物类型管理

#### 3.3.1 动物类型列表
**接口地址**: `GET /api/support/animal-types`

**请求参数**:
```json
{
  "page": 1,          // 页码
  "pageSize": 10,     // 每页数量
  "name": "小鼠"      // 可选，动物类型名称模糊查询
}
```

**响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "list": [
      {
        "id": 1,
        "name": "小鼠",
        "created_at": "2026-01-01 00:00:00"
      },
      {
        "id": 2,
        "name": "大鼠",
        "created_at": "2026-01-01 00:00:00"
      }
    ],
    "total": 2,
    "page": 1,
    "page_size": 10,
    "total_pages": 1
  }
}
```

**权限要求**: `animal_type:list`

---

#### 3.3.2 创建动物类型
**接口地址**: `POST /api/support/animal-types`

**请求参数**:
```json
{
  "name": "小鼠"  // 必填，动物类型名称
}
```

**响应数据**:
```json
{
  "code": 200,
  "message": "创建成功",
  "data": {
    "id": 3,
    "name": "小鼠",
    "created_at": "2026-01-07 16:00:00"
  }
}
```

**业务逻辑**:
1. 验证动物类型名称唯一性

**权限要求**: `animal_type:create`

---

#### 3.3.3 更新动物类型
**接口地址**: `PUT /api/support/animal-types/:id`

**请求参数**:
```json
{
  "name": "实验小鼠"  // 必填，动物类型名称
}
```

**响应数据**:
```json
{
  "code": 200,
  "message": "更新成功",
  "data": null
}
```

**业务逻辑**:
1. 验证新动物类型名称唯一性

**权限要求**: `animal_type:update`

---

#### 3.3.4 删除动物类型
**接口地址**: `DELETE /api/support/animal-types/:id`

**响应数据**:
```json
{
  "code": 200,
  "message": "删除成功",
  "data": null
}
```

**业务逻辑**:
1. 检查是否有笼位、订单使用此动物类型，有则不允许删除
2. 物理删除

**权限要求**: `animal_type:delete`

---

#### 3.3.5 动物类型详情
**接口地址**: `GET /api/support/animal-types/:id`

**响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "name": "小鼠",
    "created_at": "2026-01-01 00:00:00",
    "updated_at": "2026-01-01 00:00:00"
  }
}
```

**权限要求**: `animal_type:detail`

---

#### 3.3.6 获取动物类型选项列表
**接口地址**: `GET /api/support/animal-types/options`

**响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 1,
      "name": "小鼠"
    },
    {
      "id": 2,
      "name": "大鼠"
    }
  ]
}
```

**说明**: 返回所有动物类型，用于下拉选择

**权限要求**: 无（已登录即可）

---

## 4. 系统配置管理接口

### 4.1 获取系统配置
**接口地址**: `GET /api/support/system-configs/:key`

**URL参数**:
- `key`: 配置键，例如 `oss_config`, `sms_config`

**响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "id": 1,
    "config_key": "oss_config",
    "config_value": "{\"accessKeyId\":\"xxx\",\"accessKeySecret\":\"xxx\",\"bucket\":\"xxx\",\"region\":\"oss-cn-hangzhou\"}",
    "description": "OSS配置",
    "updated_at": "2026-01-01 00:00:00"
  }
}
```

**权限要求**: `system_config:view`

---

### 4.2 更新系统配置
**接口地址**: `PUT /api/support/system-configs/:key`

**请求参数**:
```json
{
  "config_value": "{\"accessKeyId\":\"new_xxx\",\"accessKeySecret\":\"new_xxx\"}",  // 必填，配置值（JSON字符串）
  "description": "OSS配置（已更新）"                                               // 可选，配置描述
}
```

**响应数据**:
```json
{
  "code": 200,
  "message": "更新成功",
  "data": null
}
```

**业务逻辑**:
1. 如果配置不存在则创建，存在则更新
2. 验证configValue是否为有效的JSON字符串

**权限要求**: `system_config:update`

---

### 4.3 获取所有系统配置列表
**接口地址**: `GET /api/support/system-configs`

**响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 1,
    "config_key": "oss_config",
    "config_value": "{...}",
      "description": "OSS配置",
      "updated_at": "2026-01-01 00:00:00"
    },
    {
      "id": 2,
      "config_key": "sms_config",
      "config_value": "{...}",
      "description": "短信配置",
      "updated_at": "2026-01-01 00:00:00"
    }
  ]
}
```

**权限要求**: `system_config:list`

---

### 4.4 获取提前预约天数配置（统一接口）
**接口地址**: `GET /api/support/advance-days`

**响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "equipment_advance_days": 7,      // 设备租赁提前预约天数
    "cage_advance_days": 7,            // 笼位租赁提前预约天数
    "experiment_advance_days": 7       // 实验代操作提前预约天数
  }
}
```

**说明**: 统一返回所有模块的提前预约天数配置，避免多次请求

**权限要求**: 无（已登录即可）

**更新方式**: 使用 `PUT /api/support/system-configs/:key` 接口更新对应的配置键：
- `equipment_advance_days` - 设备租赁提前预约天数
- `cage_advance_days` - 笼位租赁提前预约天数
- `experiment_advance_days` - 实验代操作提前预约天数

---

## 5. 文件上传接口

### 5.1 上传图片
**接口地址**: `POST /api/support/upload/image`

**请求头**:
```
Content-Type: multipart/form-data
```

**请求参数**:
- `file`: 文件对象（表单字段名）

**响应数据**:
```json
{
  "code": 200,
  "message": "上传成功",
  "data": {
    "url": "https://oss.example.com/images/20260107/xxxx.jpg",
    "filename": "xxxx.jpg",
    "size": 102400,
    "mime_type": "image/jpeg"
  }
}
```

**业务逻辑**:
1. 验证文件类型（仅允许jpg, jpeg, png, gif, webp）
2. 验证文件大小（最大5MB）
3. 生成唯一文件名
4. 上传到OSS
5. 返回OSS文件URL

**权限要求**: 无（已登录即可）

**说明**: 
- 当前版本OSS配置未设置时，可以先将文件保存到本地临时目录
- OSS配置设置后，自动使用OSS存储

---

## 6. 数据统计接口

> ⚠️ **说明**：统计接口为**非核心功能**，当前版本暂未实现。这些接口将在后续版本中根据需求实现。

### 6.1 综合统计数据
**接口地址**: `GET /api/support/statistics/overview`

**请求参数**:
```json
{
  "start_date": "2026-01-01",  // 可选，统计开始日期
  "end_date": "2026-01-31"     // 可选，统计结束日期
}
```

**响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "users": {
      "total": 500,
      "pending": 20,
      "approved": 450,
      "rejected": 30
    },
    "equipment_reservations": {
      "total": 200,
      "pending": 10,
      "in_progress": 50,
      "completed": 130,
      "rejected": 5,
      "cancelled": 5
    },
    "cage_reservations": {
      "total": 150,
      "pending": 8,
      "in_progress": 40,
      "completed": 95,
      "rejected": 4,
      "cancelled": 3
    },
    "experiment_operations": {
      "total": 100,
      "pending": 5,
      "in_progress": 30,
      "completed": 60,
      "rejected": 3,
      "cancelled": 2
    },
    "animal_orders": {
      "total": 80,
      "pending": 10,
      "in_progress": 20,
      "completed": 45,
      "rejected": 3,
      "cancelled": 2
    },
    "reagent_orders": {
      "total": 120,
      "pending": 15,
      "in_progress": 30,
      "completed": 70,
      "rejected": 3,
      "cancelled": 2
    }
  }
}
```

**权限要求**: `statistics:overview`

**说明**: 用于管理端首页的数据概览展示

---

### 6.2 负责人完成订单统计
**接口地址**: `GET /api/support/handlers/statistics`

**请求参数**:
```json
{
  "startDate": "2026-01-01",  // 可选，统计开始日期
  "endDate": "2026-01-31",    // 可选，统计结束日期
  "handler_id": 1              // 可选，负责人ID筛选（不传则统计所有负责人）
}
```

**响应数据**:
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "list": [
      {
        "handler": {
          "id": 1,
          "name": "张三"
        },
        "equipment_reservations": {
          "total": 50,        // 总订单数
          "completed": 45,    // 已完成数量
          "in_progress": 5     // 进行中数量
        },
        "cage_reservations": {
          "total": 30,
          "completed": 25,
          "in_progress": 5
        },
        "experiment_operations": {
          "total": 20,
          "completed": 18,
          "in_progress": 2
        },
        "animal_orders": {
          "total": 15,
          "completed": 12,
          "in_progress": 3
        },
        "reagent_orders": {
          "total": 25,
          "completed": 20,
          "in_progress": 5
        },
        "summary": {
          "total_orders": 140,      // 总订单数（所有业务）
          "completed_orders": 120,  // 已完成订单数
          "in_progress_orders": 20   // 进行中订单数
        }
      },
      {
        "handler": {
          "id": 2,
          "name": "李四"
        },
        "equipment_reservations": {
          "total": 30,
          "completed": 28,
          "in_progress": 2
        },
        "cage_reservations": {
          "total": 20,
          "completed": 18,
          "in_progress": 2
        },
        "experiment_operations": {
          "total": 15,
          "completed": 14,
          "in_progress": 1
        },
        "animal_orders": {
          "total": 10,
          "completed": 9,
          "in_progress": 1
        },
        "reagent_orders": {
          "total": 18,
          "completed": 16,
          "in_progress": 2
        },
        "summary": {
          "total_orders": 93,
          "completed_orders": 85,
          "in_progress_orders": 8
        }
      }
    ],
    "total": 2  // 负责人总数
  }
}
```

**业务逻辑**:
1. 如果指定handlerId，只统计该负责人的数据
2. 如果指定时间范围，只统计该时间范围内完成的订单
3. 统计各业务模块中handler_id等于该负责人的订单：
   - equipment_reservations（设备租赁）
   - cage_reservations（笼位租赁）
   - experiment_operations（实验代操作）
   - animal_orders（动物订购）
   - reagent_orders（试剂耗材订购）
4. 统计状态：已完成（status=3）、进行中（status=1）、总订单数
5. 按负责人分组统计

**权限要求**: `statistics:handler_completion`

**说明**: 用于统计每个负责人在各个业务模块完成的订单数据，可用于绩效考核、工作量统计等
