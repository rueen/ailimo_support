# 文件上传接口

## 上传图片

### 管理端
**接口地址**: `POST /api/support/upload/image`

### 用户端
**接口地址**: `POST /api/h5/upload/image`

---

### 请求头
```
Content-Type: multipart/form-data
Authorization: Bearer {token}
```

### 请求参数
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| file | File | 是 | 图片文件（字段名） |
| directory | String | 否 | 上传目录，如 'equipment'、'cage'、'case' 等 |

### 响应数据
```json
{
  "code": 200,
  "message": "上传成功",
  "data": {
    "url": "https://your-bucket.oss-cn-hangzhou.aliyuncs.com/images/equipment/2026/01/15/1737000000000_abc123.jpg",
    "filename": "1737000000000_abc123.jpg",
    "size": 102400,
    "mime_type": "image/jpeg"
  }
}
```

### 文件限制
- **支持格式**: jpg, jpeg, png, gif, webp
- **最大大小**: 5MB
- **存储方式**: 阿里云 OSS

### 上传目录说明

**目录参数示例**：
- `equipment` - 设备相关图片
- `cage` - 笼位相关图片
- `case` - 案例图片
- `company` - 公司信息图片
- 留空 - 默认上传到 `images/` 根目录

**完整路径格式**：
```
images/{directory}/{year}/{month}/{day}/{filename}
```

**示例**：
```
不指定目录: images/2026/01/15/1737000000000_abc123.jpg
指定 equipment: images/equipment/2026/01/15/1737000000000_abc123.jpg
```

### 错误响应

**未选择文件**：
```json
{
  "code": 400,
  "message": "未选择文件"
}
```

**文件类型不支持**：
```json
{
  "code": 400,
  "message": "不支持的文件类型"
}
```

**文件过大**：
```json
{
  "code": 400,
  "message": "文件大小不能超过 5MB"
}
```

**OSS未配置**：
```json
{
  "code": 500,
  "message": "OSS未配置，请联系管理员"
}
```

### 调用示例

**JavaScript (FormData)**:
```javascript
const formData = new FormData();
formData.append('file', file);
formData.append('directory', 'equipment');

fetch('/api/support/upload/image', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${token}`
  },
  body: formData
})
.then(res => res.json())
.then(data => {
  console.log('上传成功:', data.data.url);
});
```

**cURL**:
```bash
curl -X POST http://localhost:3000/api/support/upload/image \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -F "file=@image.jpg" \
  -F "directory=equipment"
```

---

### 注意事项
1. 测试环境和生产环境都使用 OSS 存储，不再保存到本地
2. 上传后返回的 URL 可直接用于前端展示
3. OSS Bucket 需设置为"公共读"权限
4. 建议配置 OSS 防盗链，只允许指定域名访问
